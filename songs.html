<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>波普小阁的歌曲仓库</title>
    <link rel="stylesheet" href="static/modern-scrollbar.css">
    <style>

        * {
            text-align: center;
            user-select: none;
        }

        body {
            background-color: rgb(241, 243, 244);
            margin-bottom: 300px;
        }

        p {
            margin: 0;
            padding: 0;
        }

        .song {
            margin: 20px;
        }

        a {
            color: #C20C0C;
            margin: 0 0 10px 10px;
        }

        a:active {
            color: #952121;
        }

        img#netease {
            width: 100px;
            height: 50px;
        }

        img#kugou {
            width: 50px;
            height: 50px;
        }

        div.platform {
            display: inline-block;
            margin: 10px;
        }

        div.volume-control {
            --onVolume: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3dUZXh0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0zIDl2Nmg0bDUgNVY0TDcgOUgzem0xMy41IDNjMC0xLjc3LTEuMDItMy4yOS0yLjUtNC4wM3Y4LjA1YzEuNDgtLjczIDIuNS0yLjI1IDIuNS00LjAyek0xNCAzLjIzdjIuMDZjMi44OS44NiA1IDMuNTQgNSA2Ljcxcy0yLjExIDUuODUtNSA2LjcxdjIuMDZjNC4wMS0uOTEgNy00LjQ5IDctOC43N3MtMi45OS03Ljg2LTctOC43N3oiLz4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KPC9zdmc+);
            --muted: url(data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3dUZXh0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0xNi41IDEyYzAtMS43Ny0xLjAyLTMuMjktMi41LTQuMDN2Mi4yMWwyLjQ1IDIuNDVjLjAzLS4yLjA1LS40MS4wNS0uNjN6bTIuNSAwYzAgLjk0LS4yIDEuODItLjU0IDIuNjRsMS41MSAxLjUxQzIwLjYzIDE0LjkxIDIxIDEzLjUgMjEgMTJjMC00LjI4LTIuOTktNy44Ni03LTguNzd2Mi4wNmMyLjg5Ljg2IDUgMy41NCA1IDYuNzF6TTQuMjcgM0wzIDQuMjcgNy43MyA5SDN2Nmg0bDUgNXYtNi43M2w0LjI1IDQuMjVjLS42Ny41Mi0xLjQyLjkzLTIuMjUgMS4xOHYyLjA2YzEuMzgtLjMxIDIuNjMtLjk1IDMuNjktMS44MUwxOS43MyAyMSAyMSAxOS43M2wtOS05TDQuMjcgM3pNMTIgNEw5LjkxIDYuMDkgMTIgOC4xOFY0eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4=);

            background-image: var(--onVolume);
            background-repeat: no-repeat;
            background-position: center;
            width: 24px;
            height: 24px;
            padding: 3px;

            position: fixed;
            right: 30px;
            top: 30px;

            cursor: pointer;
            opacity: 1;
            transition: opacity 0.3s linear;
        }

        div.volume-control:hover {
            opacity: 0.5;
        }

        div.load-next-src {
            color: #C20C0C;
            text-decoration: underline;
            padding: 3px;
            position: fixed;
            right: 30px;
            top: 80px;

            cursor: pointer;
            opacity: 1;
            transition: all .1s linear;
        }

        div.load-next-src:hover {
            opacity: 0.5;
        }

        div.load-next-src:active {
            opacity: 1;
            color: #952121;
        }

        audio {
            width: 420px;
        }

        .v-lyrics {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
            padding: 5px 0;
        }

        .v-lyrics>video {
            aspect-ratio: 612 / 246;
            visibility: visible;
        }

        button {
            all: unset;
            color: #C20C0C;
            text-decoration: underline;
            background: transparent;
            margin-top: 6px;
            cursor: pointer;
        }

        .has-lyrics-video>.custom-control {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            padding: 3px;
            border: solid rgba(85, 84, 84, 0.4) 3px;
            background: rgb(220 220 220);
            width: fit-content;
            align-self: center;
        }

        .has-lyrics-video>.custom-control * {
            margin: 0 10px;
        }

        .has-lyrics-video>.other-part {
            display: flex;
            justify-content: center;
        }

        .has-lyrics-video {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

    </style>
</head>
<body>

    <div class="credits">
        <div class="platform">
            <a href="https://music.163.com" title="网易云音乐">
                <img src="http://www.zhiheid.com/attached/image/20190404/20190404094419_63566.jpg" alt="网易云音乐" id="netease">
            </a>
            <p style="letter-spacing: 4px; color: #C20C0C;">music.163.com</p>
        </div>

        <div class="platform">
            <a href="https://www.kugou.com/" title="酷狗音乐">
                <img src="static/kugou-music-logo.png" alt="酷狗音乐" id="kugou">
            </a>
            <p style="letter-spacing: 4px; color: #00A9FF;">www.kugou.com</p>
        </div>
    </div>

    <h1>♫我的歌曲仓库♫</h1>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=31066899">Until the Sun Comes Up</a>
        <a href="media/sun_comes_up.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=1436066046">You Ain't Never Seen It Done Like This</a>
        <a href="media/ever_seen_it_done.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🤍</p>
    </div>
    
    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=561802452">True Bromance (真正的兄弟情)</a>
        <a href="media/True_Bromance.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="media/Unking_Me.mp3">吾非国王 Unking Me</a>
        <a href="media/Unking_Me.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=1339706250">C-H-I-C-K-E-N</a>
        <a href="media/chicken.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🤍</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://www.kugou.com/song/#4mhj9c92">空木葵-LIFE</a>
        <a href="media/空木葵-LIFE.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://www.kugou.com/song/#5eqx9c9a">空木葵-DaDaDa(合奏)</a>
        <a href="media/空木葵-DaDaDa(合奏).mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🤍</p>
    </div>
    
    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=561802451">Cake O'clock - Danny Jacobs,Andy Richter</a>
        <a href="media/Danny Jacobs,Andy Richter - Cake O'clock.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/album?id=178913655">Cheetah Mobile Games,Łukasz Michalski - 旅程</a>
        <a href="media/Cheetah Mobile Games - 旅程.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🤍</p>
    </div>
    
    <div class="song">
        <audio src="" controls loop></audio><br>
        <a href="https://music.163.com/#/song?id=426881502">RADWIMPS - かたわれ時</a>
        <a href="media/RADWIMPS_-_かたわれ時.mp3" download>下载</a>
        <p>评分：🧡🧡🧡🧡🧡</p>
    </div>

    <div class="song has-lyrics-video">
        <audio src="media/500 Chunks.mp3" loop id="five500-Chunks"></audio>
        <div class="custom-control">
            <button type="button" class="play-state-toggle">播放/暂停</button>
            <button type="button" class="open-seek-dlg">改变播放进度</button>
        </div>

        <div class="other-part">
            <a href="https://www.bilibili.com/video/BV1px411579q">500 Chunks - Element Animation</a>
            <a href="media/500 Chunks.mp3" download>下载</a>
        </div>
        <p>评分：🧡🧡🧡🤍🤍</p>
    </div>

    <div class="v-lyrics">
        <video src="media/音乐歌词.mp4" data-bind-target="#five500-Chunks">您的浏览器不支持媒体API</video>
        <button type="button" id="hide-lyrics-1">隐藏此动态歌词</button>
    </div>



    <a href="#top" style="font-size: small; color: black; margin-left: 0;" class="no-blank">返回顶部</a>
    <a href="index.html" style="font-size: small; color: black;" class="no-blank">返回索引页</a>

    <div class="volume-control"></div>
    <div class="load-next-src">加载更多音频资源</div>


    <script defer>    // 初始化音频加载脚本
        const srcLst = [
            'media/sun_comes_up.mp3', 'media/ever_seen_it_done.mp3', 'media/True_Bromance.mp3',
            'media/Unking_Me.mp3', 'media/chicken.mp3', 'media/空木葵-LIFE.mp3', 'media/空木葵-DaDaDa(合奏).mp3',
            'media/Danny Jacobs,Andy Richter - Cake O\'clock.mp3', 'media/Cheetah Mobile Games - 旅程.mp3', 'media/RADWIMPS_-_かたわれ時.mp3',
        ];

        const loadBtn = document.querySelector('div.load-next-src');
        const audios = document.querySelectorAll('audio');
        var index = 0;
        var maxIndex = srcLst.length;

        loadBtn.addEventListener('click', () => {
            if (index < maxIndex) {     // 这个地方为什么用 < 而不是 <= ？  因为当它加载到最后一项后再尝试加载时，index为最后一项，maxIndex也是最后一项，就会报错。
                console.log('load-next-src, current index:' + index);
                
                audios[index].src = srcLst[index];
                audios[index].load();
            } else {
                console.log('max index reached! maxIndex:' + maxIndex);
                loadBtn.remove();
            };
            index += 1;
        });
    </script>

    <script defer>  // 将audio元素UI控制与动态歌词视频进度绑定
        const target_lyrics_video = document.querySelector('div.v-lyrics>video');

        function updateLyricsVideoProgress(audioEle, videoEle) {
            var audio_progress = audioEle.currentTime;
            videoEle.currentTime = audio_progress;
        }

        function bindLyricsVideo(audioEle, videoEle) {
            audioEle.addEventListener('timeupdate', (event) => {
                updateLyricsVideoProgress(audioEle, videoEle);
            });

            audioEle.addEventListener('play', (event) => {
                updateLyricsVideoProgress(audioEle, videoEle);
            });

            audioEle.addEventListener('pause', (event) => {
                updateLyricsVideoProgress(audioEle, videoEle);
            });
        };


        const audio_to_bind = document.querySelector(target_lyrics_video.dataset.bindTarget);
        bindLyricsVideo(audio_to_bind, target_lyrics_video);

        console.log(target_lyrics_video, target_lyrics_video.dataset.bindTarget);
    </script>

    <script>    // 给自定义音频控制UI控件添加功能
        const play_state_toggle = document.querySelector('.play-state-toggle');
        const open_seek_dlgBtn = document.querySelector('.open-seek-dlg');

        play_state_toggle.addEventListener('click', () => {
            if (audio_to_bind.paused) {
                audio_to_bind.play();
            } else {
                audio_to_bind.pause();
            }
        });
        open_seek_dlgBtn.addEventListener('click', () => {
            var time_to_seek = prompt('输入目标位置(秒)');
            if (time_to_seek == null) {
                alert('跟踪进度已取消');
            } else {
                time_to_seek = +time_to_seek;
                if (time_to_seek.toString() == 'NaN') {
                    alert('无效的目标位置');
                } else {
                    audio_to_bind.currentTime = time_to_seek;
                };
            };
        });

        const hide_lyrics = document.querySelector('#hide-lyrics-1');
        const lyricsVideo = document.querySelector('.v-lyrics>video');
        hide_lyrics.addEventListener('click', () => {
            if (lyricsVideo.style.visibility == 'hidden') {
                lyricsVideo.style.visibility = 'visible';
                hide_lyrics.textContent = '隐藏此动态歌词';
            } else {
                lyricsVideo.style.visibility = 'hidden';
                hide_lyrics.textContent = '显示此动态歌词';
            };
        });
    </script>


    <script>
        const anchors = document.querySelectorAll('a');
        anchors.forEach(element => {
            if (element.className != 'no-blank') {
                element.target = '_blank';
            };
        });
    </script>

    <script>
        const toggle = document.querySelector('.volume-control');
        toggle.addEventListener('click', () => {
            audios.forEach(element => {
                if (element.volume == 0) {
                    element.volume = 1;
                    toggle.style.backgroundImage = 'var(--onVolume)';
                } else {
                    element.volume = 0;
                    toggle.style.backgroundImage = 'var(--muted)';
                };
            });
        });
    </script>
    
</body>
</html>